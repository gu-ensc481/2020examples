function dz = doublepen(t,z, l1, l2, m1, m2, g)

z1 = z(1);
z2 = z(2);
z3 = z(3);
z4 = z(4);

dz = [(-l1.*z4.*cos(z1 - z2) + l2.*z3)./(l1.^2.*l2.*(m1 - m2.*cos(z1 - z2).^2 + m2)); 
    (l1.*m1.*z4 + l1.*m2.*z4 - l2.*m2.*z3.*cos(z1 - z2))./(l1.*l2.^2.*m2.*(m1 - m2.*cos(z1 - z2).^2 + m2)); 
    (-g.*l1.^3.*l2.^2.*m1.^3.*sin(z1) + 2*g.*l1.^3.*l2.^2.*m1.^2.*m2.*sin(z1).*cos(z1 - z2).^2 - 3*g.*l1.^3.*l2.^2.*m1.^2.*m2.*sin(z1) - g.*l1.^3.*l2.^2.*m1.*m2.^2.*sin(z1).*cos(z1 - z2).^4 + 4*g.*l1.^3.*l2.^2.*m1.*m2.^2.*sin(z1).*cos(z1 - z2).^2 - 3*g.*l1.^3.*l2.^2.*m1.*m2.^2.*sin(z1) - g.*l1.^3.*l2.^2.*m2.^3.*sin(z1).*cos(z1 - z2).^4 + 2*g.*l1.^3.*l2.^2.*m2.^3.*sin(z1).*cos(z1 - z2).^2 - g.*l1.^3.*l2.^2.*m2.^3.*sin(z1) + l1.^2.*m1.*z4.^2.*sin(2*z1 - 2*z2)/2 + l1.^2.*m2.*z4.^2.*sin(2*z1 - 2*z2)/2 - l1.*l2.*m1.*z3.*z4.*sin(z1 - z2) - l1.*l2.*m2.*z3.*z4.*sin(z1 - z2).*cos(z1 - z2).^2 - l1.*l2.*m2.*z3.*z4.*sin(z1 - z2) + l2.^2.*m2.*z3.^2.*sin(2*z1 - 2*z2)/2)./(l1.^2.*l2.^2.*(m1.^2 - 2*m1.*m2.*cos(z1 - z2).^2 + 2*m1.*m2 + m2.^2.*cos(z1 - z2).^4 - 2*m2.^2.*cos(z1 - z2).^2 + m2.^2)); 
    (-g.*l1.^2.*l2.^3.*m1.^2.*m2.*sin(z2) + 2*g.*l1.^2.*l2.^3.*m1.*m2.^2.*sin(z2).*cos(z1 - z2).^2 - 2*g.*l1.^2.*l2.^3.*m1.*m2.^2.*sin(z2) - g.*l1.^2.*l2.^3.*m2.^3.*sin(z2).*cos(z1 - z2).^4 + 2*g.*l1.^2.*l2.^3.*m2.^3.*sin(z2).*cos(z1 - z2).^2 - g.*l1.^2.*l2.^3.*m2.^3.*sin(z2) - l1.^2.*m1.*z4.^2.*sin(2*z1 - 2*z2)/2 - l1.^2.*m2.*z4.^2.*sin(2*z1 - 2*z2)/2 + l1.*l2.*m1.*z3.*z4.*sin(z1 - z2) + l1.*l2.*m2.*z3.*z4.*sin(z1 - z2).*cos(z1 - z2).^2 + l1.*l2.*m2.*z3.*z4.*sin(z1 - z2) - l2.^2.*m2.*z3.^2.*sin(2*z1 - 2*z2)/2)./(l1.^2.*l2.^2.*(m1.^2 - 2*m1.*m2.*cos(z1 - z2).^2 + 2*m1.*m2 + m2.^2.*cos(z1 - z2).^4 - 2*m2.^2.*cos(z1 - z2).^2 + m2.^2))];